{
  "workflow": {
    "meta": {
      "name": "Gmail Trigger V6 - s komentÃ¡Å™i",
      "description": "AutomatickÃ¡ AI klasifikace Gmail emailÅ¯ pomocÃ­ Mistral AI modelu. Workflow analyzuje pÅ™Ã­chozÃ­ emaily a pÅ™iÅ™azuje jim odpovÃ­dajÃ­cÃ­ labely podle 8 kategoriÃ­.",
      "version": "6.0",
      "author": "Petr Prenghy",
      "created": "2025-06-27T11:17:59.373Z",
      "tags": ["gmail", "ai", "automation", "classification", "email"],
      "features": [
        "AutomatickÃ© spouÅ¡tÄ›nÃ­ kaÅ¾dou minutu",
        "AI klasifikace do 8 kategoriÃ­",
        "PouÅ¾itÃ­ Mistral AI modelu",
        "ZpracovÃ¡nÃ­ souvisejÃ­cÃ­ch emailÅ¯",
        "Aplikace labelÅ¯ na Gmail",
        "PodrobnÃ© komentÃ¡Å™e k jednotlivÃ½m nodÅ¯m"
      ],
      "requirements": [
        "Gmail OAuth2 credentials",
        "OpenRouter API key",
        "n8n instance with LangChain nodes"
      ],
      "categories": [
        "1. To respond - OsobnÃ­ odpovÄ›di",
        "2. FYI - Akce/upozornÄ›nÃ­",
        "3. Comment - Å½Ã¡dosti o feedback",
        "4. Notification - AutomatickÃ© notifikace",
        "5. Meeting update - KalendÃ¡Å™nÃ­ udÃ¡losti",
        "6. Awaiting reply - ÄŒekÃ¡ na odpovÄ›Ä",
        "7. Actioned - PotvrzenÃ­ akcÃ­",
        "8. Marketing - PropagaÄnÃ­ obsah"
      ]
    },
    "data": {
      "createdAt": "2025-06-27T11:17:59.373Z",
      "updatedAt": "2025-06-27T11:17:59.373Z",
      "id": "kesAcXeRp2S9S7K9",
      "name": "Gmail Trigger V6 - s komentÃ¡Å™i",
      "active": false,
      "isArchived": false,
      "nodes": [
        {
          "id": "d6cad946-4038-444c-9676-e385958417b9",
          "name": "OpenRouter Chat Model",
          "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
          "position": [900, 320],
          "parameters": {
            "model": "mistralai/mistral-small-3.2-24b-instruct:free",
            "options": {}
          },
          "credentials": {
            "openRouterApi": {
              "id": "Szmeuw2dakq2xpr7",
              "name": "OpenRouter mistralai/mistral-small-3.2-24b-instruct:free"
            }
          },
          "typeVersion": 1
        },
        {
          "id": "aab6bc51-a40c-435d-af5f-36c4e3ea4141",
          "name": "Aggregate Gmail Messages",
          "type": "n8n-nodes-base.aggregate",
          "position": [-320, 0],
          "parameters": {
            "aggregate": "aggregateAllItemData",
            "options": {}
          },
          "typeVersion": 1
        },
        {
          "id": "10758bfd-9192-4bb0-bea6-e18dbe50b82c",
          "name": "Merge Labels & Messages",
          "type": "n8n-nodes-base.merge",
          "position": [600, 100],
          "parameters": {
            "mode": "combine",
            "combineBy": "combineAll",
            "options": {}
          },
          "typeVersion": 3.1
        },
        {
          "id": "b42574c6-5b12-46e9-ae74-90af5cf2c777",
          "name": "Classify Email with AI",
          "type": "@n8n/n8n-nodes-langchain.chainLlm",
          "position": [880, 100],
          "parameters": {
            "promptType": "define",
            "text": "=You are an email classification assistant. Your task is to analyze Gmail email snippets and categorize them into one of the following labels:\n\n1. To respond - Emails requiring a direct personal response from you (questions from individuals, personal conversations, NOT automated feedback requests)\n2. FYI - Emails requesting you to take action, reminders, or alerts about issues (add money requests, payment failures, action needed)\n3. Comment - Emails specifically asking for your feedback, review, or opinion in a professional/collaborative context\n4. Notification - Automated updates about completed or ongoing events (successful payments, transfers sent, deployments, shipments, security alerts)\n5. Meeting update - Calendar invites, meeting changes, or meeting-related communications\n6. Awaiting reply - Follow-up emails or reminders about your pending responses\n7. Actioned - Confirmations of actions YOU specifically took (not automated system actions)\n8. Marketing - Promotional content, sales emails, feature announcements, newsletters, or automated customer feedback surveys\n\nKey classification rules:\n- Automated status updates (deployments, transfers, payments processed) â†’ Notification\n- Requests to add money or take action â†’ FYI\n- Payment failure alerts â†’ FYI\n- Security alert digests â†’ Notification\n- Shipment updates â†’ Notification\n- Direct Debit payment confirmations â†’ Notification\n- Balance update confirmations â†’ Notification\n- Customer satisfaction surveys or feedback requests â†’ Marketing\n- Automated \"how was your experience\" emails â†’ Marketing\n- Only use \"Actioned\" for confirmations of YOUR manual actions\n- Only use \"Marketing\" for promotional content, including feedback surveys\n\nInstructions:\n1. Read the email snippet carefully\n2. Note the sender (if provided) for context\n3. Choose the single most appropriate label based on the rules above\n4. IMPORTANT: Respond ONLY with the number and label (e.g., \"2. FYI\")\n5. Do not include any other text, explanation, or repeat the email content\n\nEmail From:\n{{ $json.From }}\nEmail To:\n{{ $json.To }}\nEmail subject:\n{{ $json.Subject }}\nEmail snippet:\n{{ $json.snippet }}\n\nYour response must be exactly one of these 8 options:\n1. To respond\n2. FYI\n3. Comment\n4. Notification\n5. Meeting update\n6. Awaiting reply\n7. Actioned\n8. Marketing",
            "batching": {}
          },
          "typeVersion": 1.7
        },
        {
          "id": "c9ab7289-d6c9-466e-85ac-9bf7ade651e1",
          "name": "New Gmail Email Received",
          "type": "n8n-nodes-base.gmailTrigger",
          "position": [-600, 120],
          "parameters": {
            "pollTimes": {
              "item": [{"mode": "everyMinute"}]
            },
            "filters": {}
          },
          "credentials": {
            "gmailOAuth2": {
              "id": "Efx3JS7iiWyrLbJd",
              "name": "Gmail account"
            }
          },
          "typeVersion": 1.2
        },
        {
          "id": "7236f236-c55b-4645-9ad6-8b267b902ce5",
          "name": "Fetch Available Gmail Labels",
          "type": "n8n-nodes-base.gmail",
          "position": [-120, 0],
          "webhookId": "8574ca24-b439-4bc3-aa28-ae2b539a8d8e",
          "parameters": {
            "resource": "label",
            "returnAll": true
          },
          "credentials": {
            "gmailOAuth2": {
              "id": "Efx3JS7iiWyrLbJd",
              "name": "Gmail account"
            }
          },
          "typeVersion": 2.1
        },
        {
          "id": "db70b609-1daa-4e5b-9801-df202b992c38",
          "name": "Map Label Names to IDs",
          "type": "n8n-nodes-base.code",
          "position": [80, 0],
          "parameters": {
            "jsCode": "const items = $input.all();\nconst combinedObject = items.reduce((acc, item) => {\n  return { ...acc, [item.json.name]: item.json.id };\n}, {});\n\nreturn { combinedObject };\n"
          },
          "typeVersion": 2
        },
        {
          "id": "be5bbad0-0ce4-49db-ad68-773da8f654df",
          "name": "Apply Classification Label",
          "type": "n8n-nodes-base.gmail",
          "position": [1320, 100],
          "webhookId": "2ffe45e7-a0e3-4304-a6bf-e217c15ea6cc",
          "parameters": {
            "operation": "addLabels",
            "messageId": "={{ $('Merge Labels & Messages').item.json.id }}",
            "labelIds": "={{ $('Map Label Names to IDs').item.json.combinedObject[$json.text] }}"
          },
          "credentials": {
            "gmailOAuth2": {
              "id": "Efx3JS7iiWyrLbJd",
              "name": "Gmail account"
            }
          },
          "typeVersion": 2.1
        },
        {
          "id": "ab4921f0-24c5-4690-92e4-9074112eac27",
          "name": "Apply Classification Label1",
          "type": "n8n-nodes-base.gmail",
          "position": [2620, 100],
          "webhookId": "2ffe45e7-a0e3-4304-a6bf-e217c15ea6cc",
          "parameters": {
            "operation": "addLabels",
            "messageId": "={{ $json.messageId }}",
            "labelIds": "={{ $json.labelIds }}"
          },
          "credentials": {
            "gmailOAuth2": {
              "id": "Efx3JS7iiWyrLbJd",
              "name": "Gmail account"
            }
          },
          "typeVersion": 2.1
        },
        {
          "id": "ad2aba98-cf6f-4eef-9d9b-0eddbccf62c0",
          "name": "Gmail - search",
          "type": "n8n-nodes-base.gmail",
          "position": [1660, 100],
          "webhookId": "47a2a075-241e-4218-9a88-5a39195e4f79",
          "parameters": {
            "operation": "getAll",
            "limit": 10,
            "simple": false,
            "filters": {
              "q": "={{ $('New Gmail Email Received').item.json.From }} -in:inbox -in:sent"
            },
            "options": {}
          },
          "credentials": {
            "gmailOAuth2": {
              "id": "Efx3JS7iiWyrLbJd",
              "name": "Gmail account"
            }
          },
          "typeVersion": 2.1,
          "alwaysOutputData": true
        },
        {
          "id": "7762bb26-002d-4b78-ade6-dd167b46bde4",
          "name": "Code",
          "type": "n8n-nodes-base.code",
          "position": [2140, 100],
          "parameters": {
            "jsCode": "// ZÃ­skÃ¡me data ze vÅ¡ech pÅ™edchozÃ­ch uzlÅ¯\nconst items = $input.all();\nconst labelIds = [];\n\nitems.forEach(item => {\n  if (item.json.labelIds && Array.isArray(item.json.labelIds)) {\n    // Filtrujeme pouze labelIds zaÄÃ­najÃ­cÃ­ na \"Label_\"\n    const filteredLabels = item.json.labelIds.filter(labelId => \n      labelId.startsWith('Label_')\n    );\n    labelIds.push(...filteredLabels);\n  }\n});\n\n// KLÃÄŒOVÃ‰: ZÃ­skÃ¡me messageId pÅ¯vodnÃ­ho emailu\n// Gmail - search hledÃ¡ podle $('New Gmail Email Received').item.json.From\n// TakÅ¾e prvnÃ­ vÃ½sledek by mÄ›l bÃ½t pÅ¯vodnÃ­ email\nconst originalMessageId = $('New Gmail Email Received').item.json.id;\n\nreturn [{ json: { \n  labelIds: [...new Set(labelIds)],\n  messageId: originalMessageId\n}}];"
          },
          "typeVersion": 2,
          "alwaysOutputData": false
        },
        {
          "id": "ce462c8e-29e9-4194-bedf-6822d2abbc9f",
          "name": "Map Label Names to IDs1",
          "type": "n8n-nodes-base.code",
          "position": [300, 0],
          "parameters": {
            "jsCode": "const items = $input.all();\nconst combinedIDtoNAMES = items.reduce((acc, item) => {\n  return { ...acc, [item.json.id]: item.json.name };\n}, {});\n\nreturn { combinedIDtoNAMES };\n"
          },
          "typeVersion": 2
        },
        {
          "id": "trigger-comment",
          "name": "ğŸ“§ Gmail Trigger",
          "type": "n8n-nodes-base.stickyNote",
          "position": [-700, 240],
          "parameters": {
            "width": 350,
            "height": 120,
            "content": "ğŸ¯ **TRIGGER**: SpouÅ¡tÃ­ workflow kaÅ¾dou minutu pÅ™i pÅ™Ã­chodu novÃ©ho emailu\n\nâœ… Kontroluje Gmail ÃºÄet\nâœ… PÅ™edÃ¡vÃ¡ email data do dalÅ¡Ã­ch nodÅ¯\nâ° Polling: kaÅ¾dou minutu"
          },
          "typeVersion": 1
        },
        {
          "id": "aggregate-comment",
          "name": "ğŸ“Š Agregace",
          "type": "n8n-nodes-base.stickyNote",
          "position": [-420, -140],
          "parameters": {
            "width": 320,
            "height": 100,
            "content": "ğŸ“Š **AGREGACE**: ShromaÅ¾Äuje vÅ¡echny pÅ™Ã­chozÃ­ email zprÃ¡vy\n\nâœ… Kombinuje data z triggeru\nâœ… PÅ™ipravuje je pro dalÅ¡Ã­ zpracovÃ¡nÃ­"
          },
          "typeVersion": 1
        },
        {
          "id": "labels-comment",
          "name": "ğŸ·ï¸ Gmail Labely",
          "type": "n8n-nodes-base.stickyNote",
          "position": [-220, -140],
          "parameters": {
            "width": 320,
            "height": 100,
            "content": "ğŸ·ï¸ **NAÄŒÃTÃNÃ LABELÅ®**: ZÃ­skÃ¡vÃ¡ seznam vÅ¡ech dostupnÃ½ch Gmail labelÅ¯\n\nâœ… Komunikuje s Gmail API\nâœ… VracÃ­ nÃ¡zvy a ID vÅ¡ech labelÅ¯"
          },
          "typeVersion": 1
        },
        {
          "id": "mapping1-comment",
          "name": "ğŸ”„ MapovÃ¡nÃ­ 1",
          "type": "n8n-nodes-base.stickyNote",
          "position": [0, -140],
          "parameters": {
            "width": 280,
            "height": 100,
            "content": "ğŸ”„ **MAPOVÃNÃ 1**: VytvÃ¡Å™Ã­ slovnÃ­k nÃ¡zevâ†’ID\n\nğŸ”‘ NÃ¡zev labelu jako klÃ­Ä\nğŸ’¾ ID labelu jako hodnota\nğŸ¯ Pro snadnÃ© vyhledÃ¡nÃ­ ID"
          },
          "typeVersion": 1
        },
        {
          "id": "mapping2-comment",
          "name": "ğŸ”„ MapovÃ¡nÃ­ 2",
          "type": "n8n-nodes-base.stickyNote",
          "position": [220, -140],
          "parameters": {
            "width": 280,
            "height": 100,
            "content": "ğŸ”„ **MAPOVÃNÃ 2**: VytvÃ¡Å™Ã­ slovnÃ­k IDâ†’nÃ¡zev\n\nğŸ”‘ ID labelu jako klÃ­Ä\nğŸ’¾ NÃ¡zev labelu jako hodnota\nâ†©ï¸ ObrÃ¡cenÃ© mapovÃ¡nÃ­"
          },
          "typeVersion": 1
        },
        {
          "id": "merge-comment",
          "name": "ğŸ”— SlouÄenÃ­",
          "type": "n8n-nodes-base.stickyNote",
          "position": [520, -40],
          "parameters": {
            "width": 320,
            "height": 100,
            "content": "ğŸ”— **SLOUÄŒENÃ**: Kombinuje email data s mapovÃ¡nÃ­m labelÅ¯\n\nğŸ”€ SluÄuje dva datovÃ© proudy\nğŸ¯ PÅ™ipravuje kompletnÃ­ data pro AI"
          },
          "typeVersion": 1
        },
        {
          "id": "ai-model-comment",
          "name": "ğŸ¤– AI Model",
          "type": "n8n-nodes-base.stickyNote",
          "position": [820, 420],
          "parameters": {
            "width": 300,
            "height": 100,
            "content": "ğŸ¤– **AI MODEL**: OpenRouter Mistral model\n\nâš¡ Poskytuje AI schopnosti\nğŸ§  Pro klasifikaci emailÅ¯\nğŸ“ Model: mistral-small-3.2-24b"
          },
          "typeVersion": 1
        },
        {
          "id": "classify-comment",
          "name": "ğŸ§  AI Klasifikace",
          "type": "n8n-nodes-base.stickyNote",
          "position": [800, -40],
          "parameters": {
            "width": 350,
            "height": 140,
            "content": "ğŸ§  **AI KLASIFIKACE**: Analyzuje email a pÅ™iÅ™azuje kategorii\n\nğŸ” PouÅ¾Ã­vÃ¡ AI pro porozumÄ›nÃ­ obsahu\nğŸ“‹ 8 kategoriÃ­: To respond, FYI, Comment, Notification, Meeting update, Awaiting reply, Actioned, Marketing\nğŸ“¤ VracÃ­ pouze ÄÃ­slo a nÃ¡zev"
          },
          "typeVersion": 1
        },
        {
          "id": "apply1-comment",
          "name": "ğŸ·ï¸ Aplikace 1",
          "type": "n8n-nodes-base.stickyNote",
          "position": [1240, -40],
          "parameters": {
            "width": 320,
            "height": 100,
            "content": "ğŸ·ï¸ **APLIKACE LABELU 1**: PÅ™iÅ™azuje AI klasifikaÄnÃ­ label\n\nğŸ¯ Bere vÃ½sledek AI klasifikace\nğŸ” Najde odpovÃ­dajÃ­cÃ­ label ID\nğŸ“§ Aplikuje na pÅ¯vodnÃ­ email"
          },
          "typeVersion": 1
        },
        {
          "id": "search-comment",
          "name": "ğŸ” VyhledÃ¡vÃ¡nÃ­",
          "type": "n8n-nodes-base.stickyNote",
          "position": [1580, -40],
          "parameters": {
            "width": 320,
            "height": 100,
            "content": "ğŸ” **HLEDÃNÃ EMAILÅ®**: HledÃ¡ dalÅ¡Ã­ emaily od stejnÃ©ho odesÃ­latele\n\nğŸš« Filtruje mimo inbox a sent\nğŸ”— NalezenÃ­ souvisejÃ­cÃ­ch zprÃ¡v\nğŸ“Š Limit: 10 emailÅ¯"
          },
          "typeVersion": 1
        },
        {
          "id": "filter-comment",
          "name": "âš™ï¸ FiltrovÃ¡nÃ­",
          "type": "n8n-nodes-base.stickyNote",
          "position": [2060, -40],
          "parameters": {
            "width": 320,
            "height": 100,
            "content": "âš™ï¸ **FILTROVÃNÃ LABELÅ®**: ZpracovÃ¡vÃ¡ labely nalezenÃ½ch emailÅ¯\n\nğŸ·ï¸ Pouze labely 'Label_*'\nğŸ¯ PÅ™ipravuje pro finÃ¡lnÃ­ aplikaci\nğŸ—‘ï¸ OdstraÅˆuje duplikÃ¡ty"
          },
          "typeVersion": 1
        },
        {
          "id": "apply2-comment",
          "name": "ğŸ·ï¸ Aplikace 2",
          "type": "n8n-nodes-base.stickyNote",
          "position": [2540, -40],
          "parameters": {
            "width": 320,
            "height": 100,
            "content": "ğŸ·ï¸ **APLIKACE LABELU 2**: FinÃ¡lnÃ­ aplikace vÅ¡ech labelÅ¯\n\nğŸ“Œ Aplikuje vÅ¡echny relevantnÃ­ labely\nğŸ¯ PouÅ¾Ã­vÃ¡ message ID pÅ¯vodnÃ­ho emailu\nâœ… ZavrÅ¡uje proces klasifikace"
          },
          "typeVersion": 1
        },
        {
          "id": "workflow-overview",
          "name": "ğŸ“‹ PÅ™ehled Workflow",
          "type": "n8n-nodes-base.stickyNote",
          "position": [-800, -100],
          "parameters": {
            "width": 400,
            "height": 180,
            "content": "ğŸ“‹ **GMAIL TRIGGER V6 - PÅ˜EHLED**\n\nğŸ¯ **ÃšÄel**: AutomatickÃ¡ AI klasifikace Gmail emailÅ¯\n\nğŸ”„ **Tok**:\n1ï¸âƒ£ Trigger â†’ 2ï¸âƒ£ Agregace â†’ 3ï¸âƒ£ NaÄtenÃ­ labelÅ¯\n4ï¸âƒ£ MapovÃ¡nÃ­ â†’ 5ï¸âƒ£ SlouÄenÃ­ â†’ 6ï¸âƒ£ AI klasifikace\n7ï¸âƒ£ PrvnÃ­ aplikace â†’ 8ï¸âƒ£ HledÃ¡nÃ­ â†’ 9ï¸âƒ£ FiltrovÃ¡nÃ­\nğŸ”Ÿ FinÃ¡lnÃ­ aplikace\n\nâš¡ **Status**: KaÅ¾dou minutu, automaticky"
          },
          "typeVersion": 1
        }
      ],
      "connections": {
        "OpenRouter Chat Model": {
          "ai_languageModel": [
            [
              {
                "node": "Classify Email with AI",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "Classify Email with AI": {
          "main": [
            [
              {
                "node": "Apply Classification Label",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Map Label Names to IDs": {
          "main": [
            [
              {
                "node": "Map Label Names to IDs1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Merge Labels & Messages": {
          "main": [
            [
              {
                "node": "Classify Email with AI",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Aggregate Gmail Messages": {
          "main": [
            [
              {
                "node": "Fetch Available Gmail Labels",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "New Gmail Email Received": {
          "main": [
            [
              {
                "node": "Aggregate Gmail Messages",
                "type": "main",
                "index": 0
              },
              {
                "node": "Merge Labels & Messages",
                "type": "main",
                "index": 1
              }
            ]
          ]
        },
        "Fetch Available Gmail Labels": {
          "main": [
            [
              {
                "node": "Map Label Names to IDs",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Apply Classification Label": {
          "main": [
            [
              {
                "node": "Gmail - search",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Gmail - search": {
          "main": [
            [
              {
                "node": "Code",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Code": {
          "main": [
            [
              {
                "node": "Apply Classification Label1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Map Label Names to IDs1": {
          "main": [
            [
              {
                "node": "Merge Labels & Messages",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "saveExecutionProgress": true,
        "saveManualExecutions": true,
        "saveDataErrorExecution": "all",
        "saveDataSuccessExecution": "all",
        "executionTimeout": 3600,
        "timezone": "UTC"
      },
      "staticData": null,
      "meta": null,
      "pinData": null,
      "versionId": "d7d65007-6b93-453c-a017-d0c7155f83a0",
      "triggerCount": 0
    }
  },
  "installation": {
    "steps": [
      "1. Importujte tento JSON soubor do n8n",
      "2. Nakonfigurujte Gmail OAuth2 credentials",
      "3. Nakonfigurujte OpenRouter API credentials",
      "4. VytvoÅ™te Gmail labely podle kategoriÃ­ (1-8)",
      "5. Aktivujte workflow",
      "6. Workflow se spustÃ­ automaticky kaÅ¾dou minutu"
    ],
    "notes": [
      "Workflow vyÅ¾aduje LangChain nody v n8n",
      "DoporuÄuje se testovÃ¡nÃ­ pÅ™ed aktivacÃ­",
      "MÅ¯Å¾e bÃ½t potÅ™eba upravit klasifikaÄnÃ­ pravidla podle potÅ™eb"
    ]
  }
}